<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register - AutoPlus</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* minimal helpers so errors look decent even without CSS changes */
    .field { margin-bottom: 12px; }
    .field label { display:block; margin-bottom:6px; font-weight:600; }
    .error-text { color:#ff4d4f; font-size:0.9rem; margin-top:6px; display:none; }
    .has-error .error-text { display:block; }
    .has-error input { border:1px solid #ff4d4f; }

    /* eye toggle */
    .input-wrap{ position:relative; }
    .input-wrap input{ padding-right:44px; }            /* room for eye */
    .toggle-pass{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      background:transparent; border:0; padding:4px; cursor:pointer;
      color:#9ca3af;
    }
    .toggle-pass:focus{ outline:2px solid #4f46e5; outline-offset:2px; border-radius:8px; }
    .toggle-pass .icon{ width:22px; height:22px; display:block; }
    .toggle-pass .eye-off{ display:none; }
    .toggle-pass.on{ color:#ffffff; }
    .toggle-pass.on .eye{ display:none; }
    .toggle-pass.on .eye-off{ display:block; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <img src="../public/images/WhatsApp Image 2025-07-26 at 12.23.11_578aa159.jpg" alt="AutoPlus Logo" />
      </div>
    <style>
    /* Right-side button group */
    .nav-right{
    display:flex;
    align-items:center;
    gap: 10px;/* primary spacing */
    }
    /* Fallback in case gap is overridden/not applied */
    .nav-right > * + *{
    margin-left: 10px;
    }
    /* Optional: keep the group from touching the edge */
    .navbar{ padding-right: 16px; }
    </style>
    <div class="nav-spacer"></div>
    <div class="nav-right">
      <a href="login.html"><button class="login-btn">Login</button></a>
      <a href="index.html"><button class="login-btn">Home</button></a>
    </div>
    </nav>
  </header>

  <!-- Register -->
  <section class="hero login-hero">
    <div class="overlay"></div>
    <div class="login-box">
      <h1>Create your AutoPlus account</h1>

      <form id="registerForm" novalidate>
        <div class="field" id="group-name">
          <label for="name">Name</label>
          <input id="name" name="name" type="text" placeholder="Your name" autocomplete="name" required />
          <div class="error-text">Please enter your name (min 2 characters).</div>
        </div>

        <div class="field" id="group-email">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" autocomplete="email" required />
          <div class="error-text">Please enter a valid email.</div>
        </div>

        <div class="field" id="group-mobile">
          <label for="mobile">Mobile No</label>
          <input id="mobile" name="mobile" type="tel" placeholder="07XXXXXXXX" inputmode="numeric" autocomplete="tel" required />
          <div class="error-text">Mobile should be 7â€“15 digits.</div>
        </div>

        <div class="field" id="group-password">
          <label for="password">Password</label>
          <div class="input-wrap">
            <input id="password" name="password" type="password" placeholder="8+ characters" minlength="8" autocomplete="new-password" required />
            <button type="button" class="toggle-pass" id="togglePass" aria-label="Show password" aria-pressed="false">
              <!-- eye (open) -->
              <svg class="icon eye" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <!-- eye-off -->
              <svg class="icon eye-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.78 21.78 0 0 1 5.06-6.94"/>
                <path d="M1 1l22 22"/>
                <path d="M10.58 10.58a3 3 0 1 0 4.24 4.24"/>
                <path d="M9.88 4.12A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.9 21.9 0 0 1-3.49 4.75"/>
              </svg>
            </button>
          </div>
          <div class="error-text">Password must be at least 8 characters.</div>
        </div>

        <div class="field" id="group-confirm">
          <label for="confirm">Confirm Password</label>
          <div class="input-wrap">
            <input id="confirm" name="confirm" type="password" placeholder="Re-enter password" autocomplete="new-password" required />
            <button type="button" class="toggle-pass" id="toggleConfirm" aria-label="Show password" aria-pressed="false">
              <!-- eye (open) -->
              <svg class="icon eye" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <!-- eye-off -->
              <svg class="icon eye-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.78 21.78 0 0 1 5.06-6.94"/>
                <path d="M1 1l22 22"/>
                <path d="M10.58 10.58a3 3 0 1 0 4.24 4.24"/>
                <path d="M9.88 4.12A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.9 21.9 0 0 1-3.49 4.75"/>
              </svg>
            </button>
          </div>
          <div class="error-text">Passwords do not match.</div>
        </div>

        <button type="submit" class="btn" id="submitBtn">Register</button>
      </p>
      </form>
    </div>
  </section>

<script>
  const API_BASE = "http://127.0.0.1:5000";

  const form = document.getElementById('registerForm');
  const submitBtn = document.getElementById('submitBtn');

  const $ = (id) => document.getElementById(id);
  const groups = {
    name: $('group-name'),
    email: $('group-email'),
    mobile: $('group-mobile'),
    password: $('group-password'),
    confirm: $('group-confirm')
  };

  function setError(groupEl, hasError) {
    if (!groupEl) return;
    groupEl.classList.toggle('has-error', !!hasError);
  }

  function validate() {
    const name = $('name').value.trim();
    const email = $('email').value.trim();
    const mobile = $('mobile').value.trim();
    const password = $('password').value;
    const confirm = $('confirm').value;

    let ok = true;

    if (name.length < 2) { setError(groups.name, true); ok = false; } else { setError(groups.name, false); }
    const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    if (!emailOk) { setError(groups.email, true); ok = false; } else { setError(groups.email, false); }
    const cleanMobile = mobile.replace(/\D/g, '');
    const mobileOk = /^\d{7,15}$/.test(cleanMobile);
    if (!mobileOk) { setError(groups.mobile, true); ok = false; } else { setError(groups.mobile, false); }
    if (password.length < 8) { setError(groups.password, true); ok = false; } else { setError(groups.password, false); }
    if (confirm !== password || !confirm) { setError(groups.confirm, true); ok = false; } else { setError(groups.confirm, false); }

    return ok;
  }

  function attachToggle(inputId, btnId){
    const input = document.getElementById(inputId);
    const btn   = document.getElementById(btnId);
    if (!input || !btn) return;
    btn.addEventListener('click', () => {
      const showing = input.type === 'text';
      input.type = showing ? 'password' : 'text';
      btn.classList.toggle('on', !showing);
      btn.setAttribute('aria-pressed', String(!showing));
      btn.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
    });
  }
  attachToggle('password', 'togglePass');
  attachToggle('confirm', 'toggleConfirm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validate()) return;
    submitBtn.disabled = true;

    const payload = {
      name: $('name').value.trim(),
      email: $('email').value.trim(),
      mobile: $('mobile').value.replace(/\D/g, ''),
      password: $('password').value
    };

    try {
      const res = await fetch(`${API_BASE}/api/auth/register`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (!res.ok || !data.ok) throw new Error(data.error || 'Registration failed');

      // Save token and user
      localStorage.setItem('autoplus_token', data.token);
      localStorage.setItem('autoplus_user', JSON.stringify(data.user));

      // Go to Upload (or My Vehicles)
      window.location.href = 'upload.html';
    } catch (err) {
      alert(err.message || 'Registration failed');
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>
